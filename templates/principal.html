<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Principal - Mantenimiento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Mantenimiento</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <span class="navbar-text text-white me-3">Usuario: {{ nombre }}</span>
                </li>
                <li class="nav-item">
                    <a class="btn btn-outline-light" href="{{ url_for('logout') }}">Cerrar sesión</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h2>Registro de Mantenimiento</h2>
    <form method="POST" class="row g-3 mb-4">
        <input type="hidden" name="action" value="guardar">
        <div class="col-md-3">
            <label class="form-label">Fecha</label>
            <input type="date" class="form-control" name="fecha" value="{{ date.today() }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Sede</label>
            <select class="form-select" name="sede">
                {% for s in sedes[1:] %}
                <option value="{{ s }}">{{ s }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Área</label>
            <input type="text" class="form-control" name="area">
        </div>
        <div class="col-md-3">
            <label class="form-label">Técnico</label>
            <input type="text" class="form-control" name="tecnico" value="{{ nombre }}" readonly>
        </div>

        <div class="col-md-3">
            <label class="form-label">Nombre Máquina</label>
            <input type="text" class="form-control" name="nombre_maquina">
        </div>
        <div class="col-md-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" name="usuario_equipo">
        </div>
        <div class="col-md-3">
            <label class="form-label">Tipo de Equipo</label>
            <select class="form-select" name="tipo_equipo">
                <option value="Seleccione..">Seleccione..</option>
                <option value="Portátil">Portátil</option>
                <option value="All In One">All in One</option>
                <option value="Impresora">Impresora</option>
                <option value="Computador de Escritorio">Computador de Escritorio</option>
                <option value="Servidor">Servidor</option>
                <option value="Otro">Otro</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Marca</label>
            <input type="text" class="form-control" name="marca">
        </div>

        <div class="col-md-3">
            <label class="form-label">Modelo</label>
            <input type="text" class="form-control" name="modelo">
        </div>
        <div class="col-md-3">
            <label class="form-label">Serial</label>
            <input type="text" class="form-control" name="serial">
        </div>
        <div class="col-md-3">
            <label class="form-label">Sistema Operativo</label>
            <select class="form-select" name="so">
                <option value="Seleccione..">Seleccione..</option>
                <option value="Windows 10 Pro 22H2">Windows 10 Pro 22H2</option>
                <option value="Windows 11 Pro 23H2">Windows 11 Pro 23H2</option>
                <option value="Windows 11 Pro 24H2">Windows 11 Pro 24H2</option>
                <option value="MacOS">MacOS</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Office</label>
            <select class="form-select" name="office">
                <option value="Seleccione..">Seleccione..</option>
                <option value="Microsoft Office 2013">Microsoft Office 2013</option>
                <option value="Microsoft Office 365">Microsoft Office 365</option>
                <option value="Microsoft Office 2016">Microsoft Office 2016</option>
                <option value="Microsoft Office 2019">Microsoft Office 2019</option>
                <option value="Microsoft Office 2021">Microsoft Office 2021</option>
                <option value="No">No</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Antivirus</label>
            <select class="form-select" name="antivirus">
                <option value="Seleccione..">Seleccione..</option>
                <option value="Kaspesky Endpoint">Kaspesky Endpoint</option>
                <option value="Windows Defender">Windows Defender</option>
                <option value="Avast">Avast</option>
                <option value="Otro">Otro</option>
                <option value="No">No</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Compresor</label>
            <select class="form-select" name="compresor">
                <option value="Seleccione..">Seleccione..</option>
                <option value="WinRaR">WinRaR</option>
                <option value="7-Zip">7-Zip</option>
                <option value="PeaZip">PeaZip</option>
                <option value="No">No</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Control Remoto</label>
            <select class="form-select" name="control_remoto">
                <option value="Seleccione..">Seleccione..</option>
                <option value="AnyDesk">AnyDesk</option>
                <option value="TeamViewer">TeamViewer</option>
                <option value="RuskDesk">RuskDesk</option>
                <option value="No">No</option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Activo Fijo</label>
            <input type="text" class="form-control" name="activo_fijo">
        </div>
        <div class="col-md-12">
            <label class="form-label">Observaciones</label>
            <textarea class="form-control" name="observaciones"></textarea>
        </div>

        <div class="col-12">
            <button type="submit" class="btn btn-primary">Guardar Registro</button>
        </div>
    </form>

    <h2>Registros</h2>
    <form method="GET" class="row g-3 mb-3">
        <div class="col-md-4">
            <input type="text" class="form-control" name="q" placeholder="Buscar..." value="{{ search }}">
        </div>
        <div class="col-md-4">
            <select class="form-select" name="sede">
                {% for s in sedes %}
                <option value="{{ s }}" {% if sede_filter == s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-secondary">Filtrar</button>
        </div>
    </form>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Sede</th>
                <th>Área</th>
                <th>Técnico</th>
                <th>Máquina</th>
                <th>Usuario</th>
                <th>Tipo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for r in registros %}
            <tr>
                <td>{{ r.id }}</td>
                <td>{{ r.fecha }}</td>
                <td>{{ r.sede }}</td>
                <td>{{ r.area }}</td>
                <td>{{ r.tecnico }}</td>
                <td>{{ r.nombre_maquina }}</td>
                <td>{{ r.usuario }}</td>
                <td>{{ r.tipo_equipo }}</td>
                <td>
                    <a href="{{ url_for('acta', rid=r.id) }}" class="btn btn-sm btn-success">Acta PDF</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>